<scroll-view wx:if="{{message}}" class="ui-page wall-detail-page" scroll-y="true">
    <view class="ui-card wall-detail-hero">
        <view class="wall-detail-hero__meta">
            <view class="wall-detail-hero__author">
                <image class="wall-detail-hero__avatar" src="{{message.author_avatar}}" mode="aspectFill"></image>
                <view class="wall-detail-hero__author-info">
                    <text class="wall-detail-hero__name">{{message.vauthor}}</text>
                    <text class="wall-detail-hero__time">{{message.vtimestamp}}</text>
                </view>
            </view>
            <text class="wall-detail-hero__tag type-{{message.message_type}}">{{message.vmessage_type}}</text>
        </view>
        <text class="wall-detail-hero__title" wx:if="{{message.title}}">{{message.title}}</text>
    </view>

    <view class="ui-card wall-detail-content">
        <text class="wall-detail-content__text">{{message.content}}</text>
        <view wx:if="{{hasimage}}" class="wall-detail-content__media">
            <t-grid column="{{4}}">
                <t-grid-item wx:for="{{images}}" wx:for-item="item" wx:key="id">
                    <t-image src="{{item.src}}" width="156" height="156" bind:tap="showImg" data-id="{{item.id}}"></t-image>
                </t-grid-item>
            </t-grid>
        </view>
    </view>
    <t-image-viewer
        background-color="white"
        default-visible="{{false}}"
        showIndex="{{true}}"
        visible="{{showDetail}}"
        images="{{srcs}}"
        bind:change="onChange"
        bind:close="onClose"
        initial-index="{{index}}"
    ></t-image-viewer>

    <view class="ui-card wall-detail-meta" wx:if="{{message.location || message.contact_info}}">
        <view class="wall-detail-meta__row" wx:if="{{message.location}}">
            <text class="wall-detail-meta__label">ğŸ“ ä½ç½®</text>
            <text class="wall-detail-meta__value">{{message.location}}</text>
        </view>
        <view class="wall-detail-meta__row" wx:if="{{message.contact_info}}">
            <text class="wall-detail-meta__label">ğŸ“ è”ç³»æ–¹å¼</text>
            <text class="wall-detail-meta__value is-selectable" user-select="{{true}}">{{message.contact_info}}</text>
        </view>
    </view>

    <view class="ui-card wall-detail-tags" wx:if="{{message.tags}}">
        <text class="wall-detail-section__title">æ ‡ç­¾</text>
        <view class="ui-chip-set">
            <text class="wall-detail-tag" wx:for="{{message.vtags}}" wx:key="*this">{{item}}</text>
        </view>
    </view>

    <view class="ui-card ui-card--quiet wall-detail-stats">
        <view class="wall-detail-stat">
            <text class="wall-detail-stat__label">æµè§ˆæ¬¡æ•°</text>
            <text class="wall-detail-stat__value">{{message.view_count}}</text>
        </view>
        <view class="wall-detail-stat">
            <text class="wall-detail-stat__label">ç‚¹èµæ¬¡æ•°</text>
            <text class="wall-detail-stat__value">{{message.like_count}}</text>
        </view>
    </view>

    <view class="ui-card wall-detail-actions">
        <button class="wall-detail-actions__btn wall-detail-actions__btn--primary" bindtap="onLike" disabled="{{liking}}">
            ğŸ‘ {{liking ? 'ç‚¹èµä¸­...' : 'ç‚¹èµ'}}
        </button>
        <button class="wall-detail-actions__btn wall-detail-actions__btn--ghost" wx:if="{{message.contact_info}}" bindtap="copyContact">
            ğŸ“‹ å¤åˆ¶è”ç³»æ–¹å¼
        </button>
    </view>

    <view class="ui-card wall-detail-discussion">
        <view class="wall-detail-discussion__head">
            <text class="wall-detail-section__title">è®¨è®ºåŒº</text>
            <text class="wall-detail-discussion__hint">æ¬¢è¿åˆ†äº«ä½ çš„çœ‹æ³•</text>
        </view>
        <view class="wall-detail-discussion__composer">
            <input class="wall-detail-discussion__input" placeholder="å‘é€å†…å®¹..." bindinput="onSendInput" value="{{sendMessage}}" />
            <button class="wall-detail-discussion__send" bindtap="onSend" size="mini">å‘é€</button>
        </view>
        <view class="wall-detail-discussion__messages" wx:if="{{messages.length > 0}}">
            <view wx:for="{{messages}}" wx:key="id" class="wall-detail-discussion__message" data-id="{{item.id}}">
                <image class="wall-detail-discussion__avatar" src="{{item.author_avatar}}" mode="aspectFill"></image>
                <view class="wall-detail-discussion__message-main">
                    <view class="wall-detail-discussion__message-head">
                        <text class="wall-detail-discussion__name">{{item.vauthor}}</text>
                        <text class="wall-detail-discussion__time">{{item.vtimestamp}}</text>
                        <text class="wall-detail-discussion__status is-pending" wx:if="{{item.isPending}}">å¾…å®¡æ ¸</text>
                        <text class="wall-detail-discussion__status is-rejected" wx:if="{{item.isRejected}}">å·²æ‹’ç»</text>
                    </view>
                    <text class="wall-detail-discussion__text">{{item.content}}</text>
                    <view class="wall-detail-discussion__footer" wx:if="{{item.like_count > 0}}">
                        <text class="wall-detail-discussion__meta">ğŸ‘ {{item.like_count}}</text>
                    </view>
                </view>
            </view>
        </view>
        <view wx:if="{{messages.length === 0}}" class="wall-detail-discussion__empty">è¿˜æ²¡æœ‰è®¨è®ºï¼Œå‘è¡¨ç¬¬ä¸€æ¡ç•™è¨€å§</view>
    </view>
</scroll-view>

<view class="wall-detail-state" wx:if="{{loading}}">åŠ è½½ä¸­...</view>

<view class="wall-detail-state wall-detail-state--error" wx:if="{{error}}">
    <text>{{error}}</text>
    <button class="wall-detail-state__btn" bindtap="loadMessage" size="mini">é‡è¯•</button>
</view>